<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tryptomics Data and Chatbot</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        h1 {
            text-align: center;
            margin-top: 20px;
        }
        #fruitSamplesTable_wrapper {
            margin: 20px;
        }
        .clickable {
            color: blue;
            cursor: pointer;
        }
        .clickable:hover {
            text-decoration: underline;
        }
        .compound-clickable:hover {
            text-decoration: underline;
            color: red;
            cursor: pointer;
        }
        #summaryBox {
            position: fixed;
            top: 10%;
            left: 50%;
            transform: translate(-50%, -10%);
            background-color: white;
            padding: 20px;
            border: 2px solid #ccc;
            box-shadow: 0px 0px 10px rgba(0,0,0,0.5);
            display: none;
            z-index: 9999;
        }
        #summaryBoxClose {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            color: red;
            font-weight: bold;
        }
        #matchingSamples {
            max-height: 200px;
            overflow-y: auto;
        }
        #chartModal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            overflow-y: auto;
        }
        #chartModalContent {
            background-color: white;
            margin: 20% auto;
            padding: 10px;
            width: 50%;
            max-width: 500px;
            max-height: 500px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        #chartClose {
            color: red;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        #myChart {
            max-height: 400px;
        }
        #similarSamplesModal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 50%;
            top: 20%;
            transform: translate(-50%, -20%);
            width: 50%;
            background-color: white;
            padding: 20px;
            border: 2px solid #ccc;
            box-shadow: 0px 0px 10px rgba(0,0,0,0.5);
        }
        #similarSamplesModalClose {
            color: red;
            float: right;
            font-size: 20px;
            cursor: pointer;
        }
		#compoundModal {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			z-index: 9999;
			display: none;
		}

		#compoundModalClose {
			cursor: pointer;
			color: red;
			float: right;
		}

    </style>
</head>
<body>
    <h1>Fruit Samples Data</h1>
    <table id="fruitSamplesTable" class="display">
        <thead>
            <tr>
                <th>Select</th>
                <th>Sample ID</th>
                <th>Sample Name</th>
                <th>Grower ID</th>
                <th>Norbaeocystin (mg/g)</th>
                <th>Baeocystin (mg/g)</th>
                <th>Psilocybin (mg/g)</th>
                <th>Psilocin (mg/g)</th>
                <th>PsilocinEQ (mg/g)</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <button id="generateGraphFromTable">Generate Graph from Selected</button>

    <div id="summaryBox">
        <span id="summaryBoxClose">X</span>
        <h2>Summary for <span id="strainName"></span></h2>
        <p>Total Samples: <span id="sampleCount"></span></p>
        <p>Min PsilocinEQ (mg/g): <span id="minPsilocin"></span></p>
        <p>Max PsilocinEQ (mg/g): <span id="maxPsilocin"></span></p>
        <p>Avg PsilocinEQ (mg/g): <span id="avgPsilocin"></span></p>

        <div id="matchingSamples">
            <!-- Checkboxes for similar sample names will go here -->
        </div>
        <button id="checkAll">Check All</button>
        <button id="uncheckAll">Uncheck All</button>
        <br><br>
        <button id="generateGraph">Graph Results</button>
    </div>

    <div id="chartModal">
        <div id="chartModalContent">
            <span id="chartClose">&times;</span>
            <canvas id="myChart" width="400" height="300"></canvas>
        </div>
    </div>

    <!-- Modal for displaying similar samples -->
    <div id="similarSamplesModal">
        <span id="similarSamplesModalClose">&times;</span>
        <h2>Similar Samples</h2>
        <p id="similarSamplesText"></p>
    </div>
	<!-- Modal for selecting compounds and colors -->
	<div id="compoundModal" style="display: none;">
		<div style="background-color: white; padding: 20px; border: 2px solid #ccc; box-shadow: 0px 0px 10px rgba(0,0,0,0.5); width: 300px; margin: 0 auto;">
			<h2>Select Compounds</h2>
			<div id="compoundSelection">
				<!-- Compound checkboxes and color pickers will be dynamically inserted here -->
			</div>
			<button id="generateCompoundGraph">Generate Graph</button>
			<button id="compoundModalClose">Close</button>
		</div>
	</div>

    <script>
        var table;
        var data;

        $(document).ready(function() {
            // Load table data from Flask backend
            $.getJSON('/get_data', function(responseData) {
                data = responseData;
                table = $('#fruitSamplesTable').DataTable({
                    data: data,
                    columns: [
                        {
                            data: null,
                            render: function (data, type, row) {
                                return `<input type="checkbox" class="select-sample" value="${row['Sample ID']}">`;
                            }
                        },
                        { data: 'Sample ID' },
                        { 
                            data: 'Sample Name', 
                            render: function(data) {
                                return `<span class="clickable" title="Click to find similar samples">${data}</span>`;
                            }
                        },
			{ data: 'Sample Type' },
                        {
                            data: 'Sample Type',
                            render: function(data) {
                                return `<span class="clickable" title="Click to find similar samples">${data}</span>`;
                            }
                        },
                        { data: 'Grower ID' },
                        { 
                            data: 'Norbaeocystin (mg/g)',
                            render: function(data) {
                                return `<span class="compound-clickable" data-compound="Norbaeocystin (mg/g)" data-value="${data}">${data}</span>`;
                            }
                        },
                        { 
                            data: 'Baeocystin (mg/g)',
                            render: function(data) {
                                return `<span class="compound-clickable" data-compound="Baeocystin (mg/g)" data-value="${data}">${data}</span>`;
                            }
                        },
                        { 
                            data: 'Psilocybin (mg/g)',
                            render: function(data) {
                                return `<span class="compound-clickable" data-compound="Psilocybin (mg/g)" data-value="${data}">${data}</span>`;
                            }
                        },
                        { 
                            data: 'Psilocin (mg/g)',
                            render: function(data) {
                                return `<span class="compound-clickable" data-compound="Psilocin (mg/g)" data-value="${data}">${data}</span>`;
                            }
                        },
                        { 
                            data: 'PsilocinEQ (mg/g)',
                            render: function(data) {
                                return `<span class="compound-clickable" data-compound="PsilocinEQ (mg/g)" data-value="${data}">${data}</span>`;
                            }
                        }
                    ]
                });

                // Handle row click event for sample names to show summary and stats
                $('#fruitSamplesTable tbody').on('click', '.clickable', function() {
                    var clickedSampleName = $(this).text().toLowerCase().replace(/[^a-z0-9\s]/gi, '').trim(); // Normalize name
					var clickedSampleWords = clickedSampleName.split(/\s+/); // Split into words for partial matching

					// Filter samples that have at least one word in common with the clicked sample name
					var filteredSamples = data.filter(sample => {
						var sampleName = sample['Sample Name'].toLowerCase().replace(/[^a-z0-9\s]/gi, '').trim();
						var sampleWords = sampleName.split(/\s+/);
						return clickedSampleWords.some(word => sampleWords.includes(word));
					});
                    var psilocinEQValues = filteredSamples.map(sample => parseFloat(sample['PsilocinEQ (mg/g)']));
                    var minPsilocin = Math.min(...psilocinEQValues);
                    var maxPsilocin = Math.max(...psilocinEQValues);
                    var avgPsilocin = (psilocinEQValues.reduce((a, b) => a + b, 0) / psilocinEQValues.length).toFixed(3);
					var psilocinValues = filteredSamples.map(sample => parseFloat(sample['Psilocin (mg/g)']) || 0);
					var psilocybinValues = filteredSamples.map(sample => parseFloat(sample['Psilocybin (mg/g)']) || 0);
					var norbaeocystinValues = filteredSamples.map(sample => parseFloat(sample['Norbaeocystin (mg/g)']) || 0);
					var baeocystinValues = filteredSamples.map(sample => parseFloat(sample['Baeocystin (mg/g)']) || 0);
					var norpsilocinValues = filteredSamples.map(sample => parseFloat(sample['Norpsilocin (mg/g)']) || 0);
					var aeruginascinValues = filteredSamples.map(sample => parseFloat(sample['Aeruginascin (mg/g)']) || 0);
					var fourHOTMTValues = filteredSamples.map(sample => parseFloat(sample['4-HO-TMT (mg/g)']) || 0);

                    $('#strainName').text(clickedSampleName);
                    $('#sampleCount').text(filteredSamples.length);
                    $('#minPsilocin').text(minPsilocin);
                    $('#maxPsilocin').text(maxPsilocin);
                    $('#avgPsilocin').text(avgPsilocin);

                    var checkboxesHTML = '';
                    filteredSamples.forEach(function(sample) {
                        checkboxesHTML += `<label><input type="checkbox" class="sampleCheckbox" value="${sample['Sample Name']}" checked> ${sample['Sample Name']}</label><br>`;
                    });
                    $('#matchingSamples').html(checkboxesHTML);
                    $('#summaryBox').show();
                });
				
				
				// Handle click on compound values to find similar samples
				$('#fruitSamplesTable tbody').on('click', '.compound-clickable', function() {
					var clickedValue = parseFloat($(this).data('value'));
					var compoundName = $(this).data('compound');

					// Find samples with similar compound values (Â±10%)
					var threshold = 0.1 * clickedValue; // 10% threshold
					var similarSamples = data.filter(sample => {
						var sampleValue = parseFloat(sample[compoundName]);
						return Math.abs(sampleValue - clickedValue) <= threshold;
					});

					if (similarSamples.length > 0) {
						// Extract data for the stacked bar chart
						var sampleNames = similarSamples.map(sample => sample['Sample Name']);
						var psilocinValues = similarSamples.map(sample => parseFloat(sample['Psilocin (mg/g)']) || 0);
						var psilocybinValues = similarSamples.map(sample => parseFloat(sample['Psilocybin (mg/g)']) || 0);
						var norbaeocystinValues = similarSamples.map(sample => parseFloat(sample['Norbaeocystin (mg/g)']) || 0);
						var baeocystinValues = similarSamples.map(sample => parseFloat(sample['Baeocystin (mg/g)']) || 0);
						var norpsilocinValues = similarSamples.map(sample => parseFloat(sample['Norpsilocin (mg/g)']) || 0);
						var aeruginascinValues = similarSamples.map(sample => parseFloat(sample['Aeruginascin (mg/g)']) || 0);
						var fourHOTMTValues = similarSamples.map(sample => parseFloat(sample['4-HO-TMT (mg/g)']) || 0);

						showStackedBarChart(sampleNames, psilocinValues, psilocybinValues, norbaeocystinValues, baeocystinValues, norpsilocinValues, aeruginascinValues, fourHOTMTValues);
					} else {
						alert("No similar samples found.");
					}
				});

				// Function to show the stacked bar chart modal
				function showStackedBarChart(sampleNames, psilocin, psilocybin, norbaeocystin, baeocystin, norpsilocin, aeruginascin, fourHOTMT) {
					var ctx = document.getElementById('myChart').getContext('2d');

					// Clear any previous chart
					if (window.barChart) {
						window.barChart.destroy();
					}

					window.barChart = new Chart(ctx, {
						type: 'bar',
						data: {
							labels: sampleNames,
							datasets: [
								{
									label: 'Psilocin (mg/g)',
									data: psilocin,
									backgroundColor: 'rgba(255, 99, 132, 0.5)',
									borderColor: 'rgba(255, 99, 132, 1)',
									borderWidth: 1
								},
								{
									label: 'Psilocybin (mg/g)',
									data: psilocybin,
									backgroundColor: 'rgba(54, 162, 235, 0.5)',
									borderColor: 'rgba(54, 162, 235, 1)',
									borderWidth: 1
								},
								{
									label: 'Norbaeocystin (mg/g)',
									data: norbaeocystin,
									backgroundColor: 'rgba(75, 192, 192, 0.5)',
									borderColor: 'rgba(75, 192, 192, 1)',
									borderWidth: 1
								},
								{
									label: 'Baeocystin (mg/g)',
									data: baeocystin,
									backgroundColor: 'rgba(153, 102, 255, 0.5)',
									borderColor: 'rgba(153, 102, 255, 1)',
									borderWidth: 1
								},
								{
									label: 'Norpsilocin (mg/g)',
									data: norpsilocin,
									backgroundColor: 'rgba(255, 159, 64, 0.5)',
									borderColor: 'rgba(255, 159, 64, 1)',
									borderWidth: 1
								},
								{
									label: 'Aeruginascin (mg/g)',
									data: aeruginascin,
									backgroundColor: 'rgba(255, 206, 86, 0.5)',
									borderColor: 'rgba(255, 206, 86, 1)',
									borderWidth: 1
								},
								{
									label: '4-HO-TMT (mg/g)',
									data: fourHOTMT,
									backgroundColor: 'rgba(75, 192, 192, 0.5)',
									borderColor: 'rgba(75, 192, 192, 1)',
									borderWidth: 1
								}
							]
						},
						options: {
							scales: {
								x: {
									stacked: true
								},
								y: {
									stacked: true,
									beginAtZero: true
								}
							},
							responsive: true,
							maintainAspectRatio: false
						}
					});

					$('#chartModal').show();
}

				// Define default colors for each compound
					var compoundColors = {
						'Psilocin (mg/g)': 'rgba(255, 99, 132, 0.5)',       // Light red
						'Psilocybin (mg/g)': 'rgba(54, 162, 235, 0.5)',     // Light blue
						'Norbaeocystin (mg/g)': 'rgba(75, 192, 192, 0.5)',  // Light green
						'Baeocystin (mg/g)': 'rgba(153, 102, 255, 0.5)',    // Light purple
						'Norpsilocin (mg/g)': 'rgba(255, 159, 64, 0.5)',    // Light orange
						'Aeruginascin (mg/g)': 'rgba(255, 206, 86, 0.5)',   // Light yellow
						'4-HO-TMT (mg/g)': 'rgba(75, 192, 192, 0.5)'        // Light cyan
					};

				// Handle row click event for sample names to show summary and stats
				$('#fruitSamplesTable tbody').on('click', '.clickable', function() {
					var clickedSampleName = $(this).text();
					var filteredSamples = data.filter(sample => sample['Sample Name'] === clickedSampleName);

					// Extract data for the stacked bar chart
					var sampleNames = filteredSamples.map(sample => sample['Sample Name']);
					var psilocinValues = filteredSamples.map(sample => parseFloat(sample['Psilocin (mg/g)']) || 0);
					var psilocybinValues = filteredSamples.map(sample => parseFloat(sample['Psilocybin (mg/g)']) || 0);
					var norbaeocystinValues = filteredSamples.map(sample => parseFloat(sample['Norbaeocystin (mg/g)']) || 0);
					var baeocystinValues = filteredSamples.map(sample => parseFloat(sample['Baeocystin (mg/g)']) || 0);
					var norpsilocinValues = filteredSamples.map(sample => parseFloat(sample['Norpsilocin (mg/g)']) || 0);
					var aeruginascinValues = filteredSamples.map(sample => parseFloat(sample['Aeruginascin (mg/g)']) || 0);
					var fourHOTMTValues = filteredSamples.map(sample => parseFloat(sample['4-HO-TMT (mg/g)']) || 0);

					showCompoundSelectionModal(sampleNames, psilocinValues, psilocybinValues, norbaeocystinValues, baeocystinValues, norpsilocinValues, aeruginascinValues, fourHOTMTValues);
				});

				// Function to show the compound selection modal with default selected compounds
				function showCompoundSelectionModal(sampleNames, psilocin, psilocybin, norbaeocystin, baeocystin, norpsilocin, aeruginascin, fourHOTMT) {
					var compounds = {
						'Psilocin (mg/g)': psilocin,
						'Psilocybin (mg/g)': psilocybin,
						'Norbaeocystin (mg/g)': norbaeocystin,
						'Baeocystin (mg/g)': baeocystin,
						'Norpsilocin (mg/g)': norpsilocin,
						'Aeruginascin (mg/g)': aeruginascin,
						'4-HO-TMT (mg/g)': fourHOTMT
					};

					$('#compoundSelection').html(compoundOptions);
					$('#compoundModal').show();

					$('#generateCompoundGraph').off('click').on('click', function() {
						var selectedCompounds = [];
						var selectedColors = [];



						if (selectedCompounds.length > 0) {
							showCustomStackedBarChart(sampleNames, selectedCompounds);
						} else {
							alert('Please select at least one compound.');
						}

						$('#compoundModal').hide();
					});
				}

				// Function to show the custom stacked bar chart
				function showCustomStackedBarChart(sampleNames, selectedCompounds) {
					var ctx = document.getElementById('myChart').getContext('2d');

					// Clear any previous chart
					if (window.barChart) {
						window.barChart.destroy();
					}

					var datasets = selectedCompounds.map(function(compoundObj) {
						return {
							label: compoundObj.compound,
							data: compoundObj.values,
							backgroundColor: compoundObj.color,
							borderColor: compoundObj.color.replace('0.5', '1'),
							borderWidth: 1
						};
					});

					window.barChart = new Chart(ctx, {
						type: 'bar',
						data: {
							labels: sampleNames,
							datasets: datasets
						},
						options: {
							scales: {
								x: {
									stacked: true
								},
								y: {
									stacked: true,
									beginAtZero: true
								}
							},
							responsive: true,
							maintainAspectRatio: false
						}
					});

					$('#chartModal').show();
				}

				// Close the compound selection modal
				$('#compoundModalClose').on('click', function() {
					$('#compoundModal').hide();
				});

                // Close the summary box
                $('#summaryBoxClose').on('click', function() {
                    $('#summaryBox').hide();
                });

                // Close the similar samples modal
                $('#similarSamplesModalClose').on('click', function() {
                    $('#similarSamplesModal').hide();
                });

				// Graph generation from the summary box checkboxes
				$('#generateGraph').on('click', function() {
					var selectedSamples = [];
					$('.sampleCheckbox:checked').each(function() {
						selectedSamples.push($(this).val());
					});

					if (selectedSamples.length > 0) {
						var filteredSamples = data.filter(sample => selectedSamples.includes(sample['Sample Name']));

						// Extract compound values for stacked bar chart
						var sampleNames = filteredSamples.map(sample => sample['Sample Name']);
						var psilocinValues = filteredSamples.map(sample => parseFloat(sample['Psilocin (mg/g)']) || 0);
						var psilocybinValues = filteredSamples.map(sample => parseFloat(sample['Psilocybin (mg/g)']) || 0);
						var norbaeocystinValues = filteredSamples.map(sample => parseFloat(sample['Norbaeocystin (mg/g)']) || 0);
						var baeocystinValues = filteredSamples.map(sample => parseFloat(sample['Baeocystin (mg/g)']) || 0);
						var norpsilocinValues = filteredSamples.map(sample => parseFloat(sample['Norpsilocin (mg/g)']) || 0);
						var aeruginascinValues = filteredSamples.map(sample => parseFloat(sample['Aeruginascin (mg/g)']) || 0);
						var fourHOTMTValues = filteredSamples.map(sample => parseFloat(sample['4-HO-TMT (mg/g)']) || 0);

						// Generate the stacked bar chart with the selected samples and their compounds
						showStackedBarChart(sampleNames, psilocinValues, psilocybinValues, norbaeocystinValues, baeocystinValues, norpsilocinValues, aeruginascinValues, fourHOTMTValues);
					} else {
						alert('Please select at least one sample.');
					}
				});

                // Graph generation from the table-selected checkboxes
                $('#generateGraphFromTable').on('click', function() {
                    var selectedSamples = [];
                    table.$('.select-sample:checked').each(function() {
                        selectedSamples.push($(this).closest('tr').find('td:eq(2)').text());  // Get Sample Name
                    });

                    if (selectedSamples.length > 0) {
                        var filteredSamples = data.filter(sample => selectedSamples.includes(sample['Sample Name']));
                        var sampleNames = filteredSamples.map(sample => sample['Sample Name']);
						var psilocinValues = filteredSamples.map(sample => parseFloat(sample['Psilocin (mg/g)']) || 0);
						var psilocybinValues = filteredSamples.map(sample => parseFloat(sample['Psilocybin (mg/g)']) || 0);
						var norbaeocystinValues = filteredSamples.map(sample => parseFloat(sample['Norbaeocystin (mg/g)']) || 0);
						var baeocystinValues = filteredSamples.map(sample => parseFloat(sample['Baeocystin (mg/g)']) || 0);
						var norpsilocinValues = filteredSamples.map(sample => parseFloat(sample['Norpsilocin (mg/g)']) || 0);
						var aeruginascinValues = filteredSamples.map(sample => parseFloat(sample['Aeruginascin (mg/g)']) || 0);
						var fourHOTMTValues = filteredSamples.map(sample => parseFloat(sample['4-HO-TMT (mg/g)']) || 0);

					   // Pass the extracted data to the graph modal
						showStackedBarChart(sampleNames, psilocinValues, psilocybinValues, norbaeocystinValues, baeocystinValues, norpsilocinValues, aeruginascinValues, fourHOTMTValues);
					} else {
						alert('Please select at least one sample.');
					}
				});

                // Function to show the stacked bar chart modal
				function showStackedBarChart(sampleNames, psilocin, psilocybin, norbaeocystin, baeocystin, norpsilocin, aeruginascin, fourHOTMT) {
					var ctx = document.getElementById('myChart').getContext('2d');

					// Clear any previous chart
					if (window.barChart) {
						window.barChart.destroy();
					}

					window.barChart = new Chart(ctx, {
						type: 'bar',
						data: {
							labels: sampleNames,
							datasets: [
								{
									label: 'Psilocin (mg/g)',
									data: psilocin,
									backgroundColor: 'rgba(255, 99, 132, 0.5)',
									borderColor: 'rgba(255, 99, 132, 1)',
									borderWidth: 1
								},
								{
									label: 'Psilocybin (mg/g)',
									data: psilocybin,
									backgroundColor: 'rgba(54, 162, 235, 0.5)',
									borderColor: 'rgba(54, 162, 235, 1)',
									borderWidth: 1
								},
								{
									label: 'Norbaeocystin (mg/g)',
									data: norbaeocystin,
									backgroundColor: 'rgba(75, 192, 192, 0.5)',
									borderColor: 'rgba(75, 192, 192, 1)',
									borderWidth: 1
								},
								{
									label: 'Baeocystin (mg/g)',
									data: baeocystin,
									backgroundColor: 'rgba(153, 102, 255, 0.5)',
									borderColor: 'rgba(153, 102, 255, 1)',
									borderWidth: 1
								},
								{
									label: 'Norpsilocin (mg/g)',
									data: norpsilocin,
									backgroundColor: 'rgba(255, 159, 64, 0.5)',
									borderColor: 'rgba(255, 159, 64, 1)',
									borderWidth: 1
								},
								{
									label: 'Aeruginascin (mg/g)',
									data: aeruginascin,
									backgroundColor: 'rgba(255, 206, 86, 0.5)',
									borderColor: 'rgba(255, 206, 86, 1)',
									borderWidth: 1
								},
								{
									label: '4-HO-TMT (mg/g)',
									data: fourHOTMT,
									backgroundColor: 'rgba(75, 192, 192, 0.5)',
									borderColor: 'rgba(75, 192, 192, 1)',
									borderWidth: 1
								}
							]
						},
						options: {
							scales: {
								x: {
									stacked: true
								},
								y: {
									stacked: true,
									beginAtZero: true
								}
							},
							responsive: true,
							maintainAspectRatio: false
						}
					});

                    $('#chartModal').show();
                }

                // Close the chart modal
                $('#chartClose').on('click', function() {
                    $('#chartModal').hide();
                });
            });



            function filterTable(filterText) {
                table.search(filterText).draw();
            }

            function renderChart(chartData) {
                var ctx = document.getElementById('myChart').getContext('2d');
                new Chart(ctx, {
                    type: chartData.type,
                    data: {
                        labels: chartData.labels,
                        datasets: chartData.datasets
                    },
                    options: chartData.options
                });
                $('#chartModal').show();
            }
        });
    </script>
</body>
</html>


